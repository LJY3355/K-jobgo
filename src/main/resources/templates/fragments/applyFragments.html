<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <!-- ▷ 공통 구직신청 테이블 (액션 컬럼 없음, pageObj 지원) -->
  <th:block th:fragment="applyEmpTable(applyList, isAdmin, filterStatus, toolbarFrag, pageObj)">
    <!-- (옵션) 상단 툴바 슬롯: 넘겨받은 fragment 자체를 삽입 -->
    <div th:if="${toolbarFrag != null}" th:insert="${toolbarFrag}"></div>

    <div class="table-scroll">
      <table class="table wide-table erp-table">
        <colgroup>
          <col style="width:44px" />   <!-- 체크박스 -->
          <col style="width:60px" />   <!-- No -->
          <col style="width:160px" />  <!-- 구인직종(또는 제목) -->
          <col style="width:120px" />  <!-- 희망국적 -->
          <col style="width:90px" />   <!-- 희망인원 -->
          <col th:if="${isAdmin}" style="width:160px" /><!-- 업체명(관리자 전용) -->
          <col style="width:120px" />  <!-- 담당자명(신청 측) -->
          <col style="width:140px" />  <!-- 담당자 연락처 -->
          <col style="width:120px" />  <!-- 처리담당자(관리자) -->
          <col style="width:110px" />  <!-- 처리상태 -->
          <col style="width:140px" />  <!-- 신청일 -->
          <col style="width:140px" />  <!-- 처리일 -->
        </colgroup>

        <thead>
          <tr>
            <th><input type="checkbox" id="checkAll"/></th>
            <th>No</th>
            <th>구인직종</th>
            <th>희망국적</th>
            <th>희망인원</th>
            <th th:if="${isAdmin}">업체명</th>
            <th>담당자명</th>
            <th>연락처</th>
            <th>처리담당자</th>
            <th>상태</th>
            <th>신청일</th>
            <th>처리일</th>
          </tr>
        </thead>

        <tbody>
          <tr th:each="row, st : ${applyList}"
              th:with="statusName=${row.status != null ? row.status.name() : 'ACTIVE'}"
              th:attr="data-job-id=${row.jobId}">
            <td><input type="checkbox" class="row-check" th:value="${row.jobId}" /></td>

            <!-- 페이지 기반 넘버링 지원 -->
            <td th:text="${pageObj != null} ? ${pageObj.number * pageObj.size + st.index + 1} : ${st.index + 1}">1</td>

            <!-- 구인직종(또는 제목) : 행 클릭 유도용 앵커 -->
            <td class="ellipsis">
              <a class="row-link"
                 th:href="${isAdmin} ? @{/admin/applyEmp/detail/{id}(id=${row.jobId})}
                                     : @{/client/applyEmp/detail/{id}(id=${row.jobId})}"
                 th:text="${row.jobType ?: row.title}">구인직종</a>
            </td>

            <td th:text="${row.desiredNationality}">-</td>
            <td th:text="${row.desiredCount}">0</td>
            <td th:if="${isAdmin}" th:text="${row.clientName}">업체명</td>
            <td th:text="${row.contactName}">담당자명</td>
            <td th:text="${row.contactPhone}">010-0000-0000</td>
            <td th:text="${row.processOwner ?: '-'}">-</td>

            <!-- 상태 칩 -->
            <td>
              <span class="chip"
                    th:classappend="${
                       statusName == 'COMPLETED' ? ' chip--approved' :
                       (statusName == 'CANCELLED' ? ' chip--rejected' : ' chip--pending')
                    }"
                    th:text="${
                      statusName == 'COMPLETED' ? '완료' :
                      (statusName == 'CANCELLED' ? '취소' : '대기')
                    }">대기</span>
            </td>

            <td th:text="${row.createdAt != null ? #temporals.format(row.createdAt,'yyyy-MM-dd') : '-'}">-</td>
            <td th:text="${row.processedAt != null ? #temporals.format(row.processedAt,'yyyy-MM-dd') : '-'}">-</td>
          </tr>

          <!-- 데이터 없음 -->
          <tr th:if="${#lists.isEmpty(applyList)}">
            <td th:colspan="${isAdmin} ? 12 : 11"
                style="text-align:center;color:#666;background:#fafafa;">
              <div style="padding:16px 0;">
                <div th:switch="${filterStatus != null ? filterStatus.name() : 'ALL'}">
                  <span th:case="'ACTIVE'">진행 중인 구직신청이 없습니다.</span>
                  <span th:case="'COMPLETED'">완료된 구직신청이 없습니다.</span>
                  <span th:case="'CANCELLED'">취소된 구직신청이 없습니다.</span>
                  <span th:case="*">표시할 데이터가 없습니다.</span>
                </div>
                <!-- 고객에게는 CTA 표시 -->
                <div th:if="${!isAdmin}">
                  <a class="btn btn--primary" th:href="@{/client/applyEmp(new=1)}" style="margin-top:10px;display:inline-block;">
                    구직신청 작성하기
                  </a>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </th:block>
</html>
